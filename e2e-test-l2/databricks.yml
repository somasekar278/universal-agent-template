bundle:
  name: e2e-test-l2

sync:
  include:
    - "*.py"
    - "*.yaml"
    - "*.yml"
    - "*.txt"
    - "*.md"

resources:
  apps:
    e2e-test-l2:
      name: e2e-test-l2
      description: "e2e-test-l2 - Context-Aware Assistant (L2)"
      source_code_path: .
      compute_size: LARGE
      config:
        command: ["python", "app.py"]
        env:
          - name: DATABRICKS_HOST
            value: "${var.databricks_host}"
          - name: LAKEBASE_HOST
            value: "${var.lakebase_host}"
          - name: LAKEBASE_DATABASE
            value: "${var.lakebase_database}"
          - name: LAKEBASE_USER
            value: "${var.lakebase_user}"
          - name: LAKEBASE_PASSWORD
            value: "${var.lakebase_password}"
          - name: PGSSLMODE
            value: "require"
          - name: PGCHANNELBINDING
            value: "disable"

targets:
  dev:
    mode: development
    default: true
    workspace:
      root_path: /Workspace/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}
  
  prod:
    mode: production
    workspace:
      root_path: /Workspace/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}
    permissions:
      - user_name: "${workspace.current_user.userName}"
        level: CAN_MANAGE

variables:
  databricks_host:
    description: "Databricks workspace URL"
    default: "https://e2-demo-field-eng.cloud.databricks.com"
  
  lakebase_host:
    description: "Lakebase PostgreSQL host"
    default: "ep-little-credit-d1b9b5ul.database.us-west-2.cloud.databricks.com"
  
  lakebase_database:
    description: "Lakebase database name"
    default: "agents"
  
  lakebase_user:
    description: "Lakebase username"
    default: "analyst"
  
  lakebase_password:
    description: "Lakebase password"
    default: "npg_PItd0Jp2jLck"
